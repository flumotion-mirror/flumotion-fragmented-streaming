<registry>

  <components>
    <component type="http-applestreamer"
               base="flumotion/component/consumers/applestreamer"
               _description="A consumer that streams mpegts video fragments following Apple's HTTP live streaming protocol">
      <source location="flumotion.component.consumers.applestreamer.applestreamer"/>

      <eater name="default" />

      <!-- entry points for distributable code bundles -->
      <entries>
        <entry type="component" location="applestreamer.py"
               function="AppleHTTPLiveStreamer" />
        <entry type="admin/gtk" location="admin_gtk.py"
               function="GUIClass" />
      </entries>

      <sockets>
        <socket type="flumotion.component.plugs.request.RequestLoggerPlug" />
        <socket type="flumotion.component.plugs.streamdata.StreamDataProviderPlug" />
        <socket type="flumotion.component.plugs.rrd.ComponentRRDPlug" />
      </sockets>

      <properties>
        <property name="description" type="string"
                  _description="A description of the stream."/>

        <property name="mount-point" type="string"
                  _description="The mount point on which the playlist and the stream can be accessed." />

        <!-- FIXME, authenticating against remote bouncers should happen through
             a plug, not this property -->
        <property name="bouncer" type="string"
                  _description="The name of a bouncer in the atmosphere to authenticate against." />
        <property name="issuer-class" type="string"
                  _description="The Python class of the Keycard issuer to use." />

        <property name="type" type="string"
                  _description="'master' to listen on a port, or 'slave' to slave to a porter (default master)." />

        <!-- If type is 'master' (default) -->
        <property name="port" type="int"
                  _description="The port to listen on (if type is 'master')." />

        <!-- If type is 'slave' -->
        <property name="porter-socket-path" type="string"
                  _description="The path to the socket to communicate with the porter." />
        <property name="porter-username" type="string"
                  _description="The username to authenticate to the porter." />
        <property name="porter-password" type="string"
                  _description="The password to authenticate to the porter." />

        <property name="hostname" type="string"
                  _description="The server's host name to display." />
        <property name="domain" type="string"
                  _description="The domain of the server for authentication." />

        <property name="client-limit" type="int"
                  _description="The maximum number of clients allowed." />
        <property name="bandwidth-limit" type="int"
                  _description="The maximum bandwidth usage allowed in bits per second." />
        <property name="redirect-on-overflow" type="string"
                  _description="A URL to redirect clients to if either of the limits have been reached." />

        <property name="duration" type="float"
                  _description="How long to keep clients connected (in seconds)."/>

        <property name="fragment-prefix" type="string"
                  _description="Fragments prefix name to use in the playlist (default:fragment)" />
        <property name="main-playlist" type="string"
                  _description="Main playlist resource name relative to the mount point (default:main.m3u8)" />
        <property name="stream-playlist" type="string"
                  _description="Stream playlist resource name relative to the mount point (default:stream.m3u8)" />
        <property name="keyframes-per-fragment" type="int"
                  _description="Number of keyframes per fragment (default:10)" />
        <property name="min-window" type="int"
                  _description="Minimun number of fragments to buffer (default:2)" />
        <property name="max-window" type="int"
                  _description="Maximum number of fragments to buffer (default:5)" />
        <property name="key-rotation" type="int"
                  _description="Number of fragments sharing the same encryption key. Use 0 for not using encryption (default:0)" />
        <property name="keys-uri" type="string"
                  _description="URI used to retrieve the encryption keys" />
      </properties>

    </component>
  </components>

  <bundles>
    <bundle project="fragmentedstreaming" name="applestreamer-base">
        <dependencies>
            <dependency name="component" />
        </dependencies>

        <directories>
            <directory name="flumotion/component/consumers/applestreamer">
                <filename location="__init__.py" />
            </directory>
        </directories>
    </bundle>

    <bundle project="fragmentedstreaming" name="applestreamer">
        <dependencies>
            <dependency name="component" />
            <dependency name="applestreamer-base" />
        </dependencies>

        <directories>
            <directory name="flumotion/component/consumers/applestreamer">
                <filename location="applestreamer.py" />
                <filename location="mpegtssegmenter.py" />
                <filename location="hlsring.py" />
                <filename location="resources.py" />
                <filename location="common.py" />
            </directory>
        </directories>
    </bundle>

    <bundle project="fragmentedstreaming" name="applestreamer-admin">
        <dependencies>
            <dependency name="component" />
            <dependency name="base-admin-gtk"/>
            <dependency name="applestreamer-base" />
        </dependencies>

        <directories>
            <directory name="flumotion/component/consumers/applestreamer">
                <filename location="applestreamer.glade" />
                <filename location="admin_gtk.py" />
            </directory>
        </directories>
    </bundle>

  </bundles>

</registry>
